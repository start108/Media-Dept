<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <!--    <link th:href="@{/css/main.css}" rel="stylesheet" />-->
    <!--    <script type="text/javascript" th:src="@{/js/main.js}"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<style>
    body {
        color: #666;
        font: 14px/24px "Open Sans", "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", Sans-Serif;
    }

    div {
        width: 100%;
        height: 500px;
        position: relative;
    }

    div.left {
        width: 60%;
        float: left;
        position: relative;
        padding: 10px;
    }

    div.right {
        width: 35%;
        float: right;
        position: relative;
        padding: 10px;
    }

    div.right-1 {
        height: 50%;
    }

    div.right-2 {
        height: 50%;
    }

    table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
    }

    th, td {
        padding: 6px 15px;
        text-align: center;
    }

    th {
        background: #42444e;
        color: #fff;
        text-align: center;
    }

    tr:first-child th:first-child {
        border-top-left-radius: 6px;
    }

    tr:first-child th:last-child {
        border-top-right-radius: 6px;
    }

    td {
        border-right: 1px solid #c6c9cc;
        border-bottom: 1px solid #c6c9cc;
    }

    td:first-child {
        border-left: 1px solid #c6c9cc;
    }

    .selectedRow {
        background: #eaeaed;
    }

    tr:last-child td:first-child {
        border-bottom-left-radius: 6px;
    }

    tr:last-child td:last-child {
        border-bottom-right-radius: 6px;
    }

    div.btn-right-area {
        float: right;
    }
</style>
<body>
<!--<p th:text="'테스트 ' + ${data}">테스트 중</p>-->
<input type="text" id="title" value="그리스도의 계절">
<button type="button" id="getAlbum">조회</button>
<button type="button" id="downloadAlbumList">다운로드</button>
<button type="button" id="addRow">+</button>
<button type="button" id="delRow">-</button>
<div>
    <div class="left">
        <!--        <div class="btn-right-area">-->
        <!--            -->
        <!--        </div>-->
        <table>
            <thead>
            <tr>
                <th></th>
                <th>앨범명</th>
                <th>가수</th>
                <th>발매일</th>
            </tr>
            </thead>
            <tbody id="listMainAlbum"></tbody>
        </table>
    </div>
    <div class="right">
        <div class="right-1">
            <button type="button" id="addDunamisRow">+</button>
            <table>
                <thead>
                <tr>
                    <th></th>
                    <th>앨범명</th>
                    <th>가수</th>
                </tr>
                </thead>
                <tbody id="listSubAlbum"></tbody>
            </table>
        </div>
        <div class="right-2">
            <table>
                <thead>
                <tr>
                    <th></th>
                    <th>앨범명</th>
                    <th>가수</th>
                </tr>
                </thead>
                <tbody id="listDunamisAlbum"></tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>
<script th:inline="javascript">
    const media = {
        albumList: [],
        albumHessedList: [],
        albumDunamisList: {},
        init: function () {

            $('#getAlbum').on('click', () => this.getAlbumList());

            $('#addRow').on('click', () => this.addRow());

            $('#addDunamisRow').on('click', () => this.addDunamisRow());

            $('#delRow').on('click', () => this.delRow());

            $('#downloadAlbumList').on('click', () => this.downloadAlbumList());

            $('#listMainAlbum').on('click', 'input[type="checkbox"][name="chkMainAlbum"]', function () {

                const row = $(this).closest('tr');

                if ($(this).prop('checked')) {
                    $('input[type="checkbox"][name="chkMainAlbum"]').prop('checked', false);
                    $('#listMainAlbum tr').removeClass('selectedRow');
                }

                $(this).prop('checked', true);
                row.addClass('selectedRow');
            });

            $('#listMainAlbum').on('click', 'tr', function () {

                const row = $(this).closest('tr');
                const chkbox = $(this).find('td:first-child :checkbox');

                $('input[type="checkbox"][name="chkMainAlbum"]').prop('checked', false);
                $('#listMainAlbum tr').removeClass('selectedRow');

                chkbox.prop('checked', true);
                row.addClass('selectedRow');
            });

            $('#listSubAlbum').on('click', 'input[type="checkbox"][name="chkSubAlbum"]', function () {

                const row = $(this).closest('tr');

                if ($(this).prop('checked')) {
                    $('input[type="checkbox"][name="chkSubAlbum"]').prop('checked', false);
                    $('#listSubAlbum tr').removeClass('selectedRow');
                }

                $(this).prop('checked', true);
                row.addClass('selectedRow');
            });

            $('#listSubAlbum').on('click', 'tr', function () {

                const row = $(this).closest('tr');
                const chkbox = $(this).find('td:first-child :checkbox');

                $('input[type="checkbox"][name="chkSubAlbum"]').prop('checked', false);
                $('#listSubAlbum tr').removeClass('selectedRow');

                chkbox.prop('checked', true);
                row.addClass('selectedRow');
            });
        },
        getAlbumList: function () {

            $.ajax({
                data: {
                    title: $("#title").val()
                },
                url: '/album',
                type: 'GET',
                success: (data) => {

                    this.albumList = data.albumList;

                    $("#listMainAlbum").empty();

                    let innerHTML = "";

                    data.albumList.forEach((album) => {

                        innerHTML += '<tr>';
                        innerHTML += '<td><input type="checkbox" name="chkMainAlbum"></td>';
                        innerHTML += '<td>' + album.title + '</td>';
                        innerHTML += '<td>' + album.singer + '</td>';
                        innerHTML += '<td>' + album.date + '</td>';
                        // innerHTML +=    '<td>' + album.lyric.replaceAll("\n", "<br>") + '</td>';
                        innerHTML += '</tr>';
                    });

                    $("#listMainAlbum").append(innerHTML);
                },
                error: (error) => {
                    alert("오류가 발생하였습니다.")
                }
            });
        },
        addRow: function () {

            this.albumList.filter((album, index) => $('#listMainAlbum tr.selectedRow').index() == index).forEach((album) => {

                let innerHTML = "";

                innerHTML += '<tr>';
                innerHTML +=    '<td><input type = "checkbox" name="chkSubAlbum"></td>';
                innerHTML +=    '<td>' + album.title + '</td>';
                innerHTML +=    '<td>' + album.singer + '</td>';
                innerHTML += '</tr>';

                $('#listSubAlbum').append(innerHTML);

                this.albumHessedList.push(album);
            });

            $('input[type="checkbox"][name="chkMainAlbum"]').prop('checked', false);
            $('#listMainAlbum tr').removeClass('selectedRow');
        },
        delRow: function () {

            this.albumHessedList.forEach((album, index) => {
                if ($('#listSubAlbum tr.selectedRow').index() == index) {
                    $('input[type="checkbox"][name="chkSubAlbum"]:checked').closest('tr').remove();
                    this.albumHessedList.splice(index);
                }
            });
        },
        addDunamisRow: function () {

            this.albumHessedList.filter((album, index) => $('#listSubAlbum tr.selectedRow').index() == index).forEach((album) => {

                let innerHTML = "";

                innerHTML += '<tr>';
                innerHTML +=    '<td><input type = "checkbox" name="chkDunamisAlbum"></td>';
                innerHTML +=    '<td>' + album.title + '</td>';
                innerHTML +=    '<td>' + album.singer + '</td>';
                innerHTML += '</tr>';

                $('#listDunamisAlbum').append(innerHTML);

                this.albumDunamisList = album;
            });

            $('input[type="checkbox"][name="chkSubAlbum"]').prop('checked', false);
            $('#listSubAlbum tr').removeClass('selectedRow');
        },
        downloadAlbumList: function () {

            const data = {
                hessed: this.albumHessedList,
                dunamis: this.albumDunamisList
            };

            $.ajax({
                data: JSON.stringify(data),
                contentType: 'application/json',
                url: '/download',
                type: 'POST',
                success: (data) => {
                    alert("다운로드 되었습니다.");
                },
                error: (error) => {
                    alert("오류가 발생하였습니다.");
                }
            });
        },
    };

    $(function () {
        media.init();
    });
</script>
