<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Hessed</title>
    <meta name=viewport content="width=device-width,initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--    <link th:href="@{/css/main.css}" rel="stylesheet" />-->
    <!--    <script type="text/javascript" th:src="@{/js/main.js}"></script>-->
</head>
<style>
    /*body {*/
    /*    color: #666;*/
    /*    font: 14px/24px "Open Sans", "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", Sans-Serif;*/
    /*}*/

    div {
        width: 100%;
        /*height: 100%;*/
        /*height: 300px;*/
        position: relative;
    }

    div.top {
        height: 50%;
    }

    div.bottom {
        height: 50%;
    }

    div.left {
        width: 50%;
        height: 50%;
        float: left;
        position: relative;
        padding: 10px;
    }

    div.right {
        width: 50%;
        float: right;
        position: relative;
        padding: 10px;
    }

    div.right-1 {
        height: 25%;
    }

    div.right-2 {
        height: 25%;
    }

    table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
    }

    th, td {
        padding: 6px 15px;
        text-align: center;
    }

    th {
        background: #42444e;
        color: #fff;
        text-align: center;
    }

    tr:first-child th:first-child {
        border-top-left-radius: 6px;
    }

    tr:first-child th:last-child {
        border-top-right-radius: 6px;
    }

    td {
        border-right: 1px solid #c6c9cc;
        border-bottom: 1px solid #c6c9cc;
    }

    td:first-child {
        border-left: 1px solid #c6c9cc;
    }

    .selectedRow {
        background: #eaeaed;
    }

    tr:last-child td:first-child {
        border-bottom-left-radius: 6px;
    }

    tr:last-child td:last-child {
        border-bottom-right-radius: 6px;
    }

    /*div.btn-right-area {*/
    /*    float: right;*/
    /*}*/

    body{
        color: #666;
        font: 14px/24px "Open Sans", "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", Sans-Serif;
        margin: 1% 10%;
    }
    input{
        border-style: groove;
        /*width: 200px;*/
    }
    ul{
        list-style-type: none;
    }
    button{
        border-style: groove;
    }
    .shadow{
        box-shadow: 3px 7px 7px rgba(0, 0, 0, 0.03);
    }
    h1{
        text-align: center;
        font-weight: 900;
        margin: 2.5rem 0 1.5rem;
    }
    .priority1{
        color: #FF5733;
    }
    .priority2{
        color: #FFC300;
    }
    .priority3{
        color: #2980B9;
    }
    .add-btn{
        background-color: #6495ED;
        float: right;
        color: white;
        width: 30%;
    }
    #add-btn-div{
        height: 40px;
        margin: 3px;
    }
    .todo-div{
        margin: 2px 0px;
        border: 2px solid #adb5bd;
        border-radius: 8px;
        padding: 10px;
        height: 140px;
    }
    .todo-btn{
        margin: 5px 10px;
    }
    /* check box */
    .custom-control-label::before,
    .custom-control-label::after {
        width: 1.25rem;
        height: 1.25rem;
    }
    .todo-header{
        /*height: 40px;*/
        border-bottom: 1px solid #bdc3c7;
    }
    .todo-header-item{
        float: left;
    }
    .title{
        padding-left: 10px;
    }
    .todo-desc{
        padding: 10px;
        color: #787878;
    }
    .dead-line-date{
        top: 0.25rem;
        font-size: 0.85rem;
        color: #2C2C2C;
    }
    .tab_list{
        display: table;
        table-layout: fixed;
        width: 100%;
        border-bottom: 1px solid #bdc3c7;
    }
    .tab_list .item {
        display: table-cell;
        text-align: center;
        vertical-align: middle;
    }
    .todo-display-none{
        display: none;
    }
    .todo-done-text{
        text-decoration: line-through;
        color: #999999;
    }

    /* 페이징 처리 */
    #pagination-demo{
        display: inline-block;
        margin-bottom: 1.75em;
    }
    #pagination-demo li{
        display: inline-block;
    }

    .page-content{
        background: #eee;
        display: inline-block;
        padding: 10px;
        width: 100%;
        max-width: 660px;
    }
    #pagination-btn{
        margin: 20px auto;
        width: 200px;
    }
    .time-over{
        font-size: 0.7rem;
        color: #FF5733;
    }
    .hessedList {

    }
</style>
<body>
<!--<div class="btn-right-area">-->
    <input type="text" id="title" value="부르신 곳에서">
    <button type="button" id="getAlbum" class="btn btn-outline-primary btn-sm">조회</button>
    <button type="button" id="downloadAlbumList" class="btn btn-outline-success btn-sm">다운로드</button>
    <button type="button" id="addRow" class="btn btn-outline-secondary btn-sm">+</button>
    <button type="button" id="delRow" class="btn btn-outline-dark btn-sm">-</button>
<!--</div>-->
<div>
    <div class="top">
        <div id="todo-list">
            <div id="todo-div" class="todo-div todo-display-none">
                <div> <!--class="todo-header"-->
                    <div id="musicList"></div>
                </div>
                <div class="hessedList">
<!--                    <button type="button" id="addDunamisRow">+</button>-->
                    <table>
                        <thead>
                        <tr>
                            <th></th>
                            <th>앨범명</th>
                            <th>가수</th>
                        </tr>
                        </thead>
                        <tbody id="listSubAlbum"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
<!--    <div class="bottom">-->
<!--        <div class="left">-->
<!--            &lt;!&ndash;        <div class="btn-right-area">&ndash;&gt;-->
<!--            &lt;!&ndash;            &ndash;&gt;-->
<!--            &lt;!&ndash;        </div>&ndash;&gt;-->
<!--            <table>-->
<!--                <thead>-->
<!--                <tr>-->
<!--                    <th></th>-->
<!--                    <th>앨범명</th>-->
<!--                    <th>가수</th>-->
<!--                    <th>발매일</th>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody id="listMainAlbum"></tbody>-->
<!--            </table>-->
<!--        </div>-->
<!--        <div class="right">-->
<!--            <div class="right-1">-->
<!--                <button type="button" id="addDunamisRow">+</button>-->
<!--                <table>-->
<!--                    <thead>-->
<!--                    <tr>-->
<!--                        <th></th>-->
<!--                        <th>앨범명</th>-->
<!--                        <th>가수</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                    <tbody id="listSubAlbum"></tbody>-->
<!--                </table>-->
<!--            </div>-->
<!--            <div class="right-2">-->
<!--                <table>-->
<!--                    <thead>-->
<!--                    <tr>-->
<!--                        <th></th>-->
<!--                        <th>앨범명</th>-->
<!--                        <th>가수</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                    <tbody id="listDunamisAlbum"></tbody>-->
<!--                </table>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
</div>
</body>
</html>
<script th:inline="javascript">
    const media = {
        albumList: [],
        albumHessedList: [],
        albumDunamisList: {},
        init: function () {

            $('#getAlbum').on('click', () => this.getAlbumList());

            $('#addRow').on('click', () => this.addRow());

            $('#addDunamisRow').on('click', () => this.addDunamisRow());

            $('#delRow').on('click', () => this.delRow());

            $('#downloadAlbumList').on('click', () => this.downloadAlbumList());

            $('#listMainAlbum').on('click', 'input[type="checkbox"][name="chkMainAlbum"]', function () {

                const row = $(this).closest('tr');

                if ($(this).prop('checked')) {
                    $('input[type="checkbox"][name="chkMainAlbum"]').prop('checked', false);
                    $('#listMainAlbum tr').removeClass('selectedRow');
                }

                $(this).prop('checked', true);
                row.addClass('selectedRow');
            });

            $('#listMainAlbum').on('click', 'tr', function () {

                const row = $(this).closest('tr');
                const chkbox = $(this).find('td:first-child :checkbox');

                $('input[type="checkbox"][name="chkMainAlbum"]').prop('checked', false);
                $('#listMainAlbum tr').removeClass('selectedRow');

                chkbox.prop('checked', true);
                row.addClass('selectedRow');
            });

            $('#listSubAlbum').on('click', 'input[type="checkbox"][name="chkSubAlbum"]', function () {

                const row = $(this).closest('tr');

                if ($(this).prop('checked')) {
                    $('input[type="checkbox"][name="chkSubAlbum"]').prop('checked', false);
                    $('#listSubAlbum tr').removeClass('selectedRow');
                }

                $(this).prop('checked', true);
                row.addClass('selectedRow');
            });

            $('#listSubAlbum').on('click', 'tr', function () {

                const row = $(this).closest('tr');
                const chkbox = $(this).find('td:first-child :checkbox');

                $('input[type="checkbox"][name="chkSubAlbum"]').prop('checked', false);
                $('#listSubAlbum tr').removeClass('selectedRow');

                chkbox.prop('checked', true);
                row.addClass('selectedRow');
            });
        },
        getAlbumList: function () {

            $.ajax({
                data: {
                    title: $("#title").val()
                },
                url: '/album',
                type: 'GET',
                success: (data) => {

                    this.albumList = data.albumList;

                    // $("#listMainAlbum").empty();
                    //
                    // let innerHTML = "";
                    //
                    // data.albumList.forEach((album) => {
                    //
                    //     innerHTML += '<tr>';
                    //     innerHTML += '<td><input type="checkbox" name="chkMainAlbum"></td>';
                    //     innerHTML += '<td>' + album.title + '</td>';
                    //     innerHTML += '<td>' + album.singer + '</td>';
                    //     innerHTML += '<td>' + album.date + '</td>';
                    //     innerHTML += '</tr>';
                    //
                    //     // $('.title.title0').text(album.title);
                    //     // $('.todo-desc.desc0').text(album.lyrics.replaceAll("\n", "<br>"));
                    // });
                    //
                    // $("#listMainAlbum").append(innerHTML);

                    $('#musicList').empty();

                    let innerHTML = "";

                    data.albumList.forEach((album) => {

                        innerHTML += '<ul class="tab_list">'
                        innerHTML += '<li class="item" style="float: left;">'
                        innerHTML += '<input type="checkbox" id="scales" name="scales">'
                        innerHTML += '</li>'
                        innerHTML += '<li class="item">'
                        innerHTML += '<div>'
                        innerHTML += '<label class="custom-control-label todo-header-item"><a href=""><strong class="title">' + album.title + '</strong></a></label>'
                        innerHTML += '<div>'
                        innerHTML += '</li>'
                        innerHTML += '<li class="item">' + album.title + '</li>';
                        innerHTML += '<li class="item">' + album.singer + '</li>';
                        innerHTML += '<li class="item">' + album.date + '</li>';
                        innerHTML += '</ul>';
                    });

                    $('#todo-div').css('display', 'block');
                    $("#musicList").append(innerHTML);

                },
                error: (error) => {
                    alert("오류가 발생하였습니다.")
                }
            });
        },
        addRow: function () {

            this.albumList.filter((album, index) => $('#listMainAlbum tr.selectedRow').index() == index).forEach((album) => {

                let innerHTML = "";

                innerHTML += '<tr>';
                innerHTML +=    '<td><input type = "checkbox" name="chkSubAlbum"></td>';
                innerHTML +=    '<td>' + album.title + '</td>';
                innerHTML +=    '<td>' + album.singer + '</td>';
                innerHTML += '</tr>';

                $('#listSubAlbum').append(innerHTML);

                this.albumHessedList.push(album);
            });

            $('input[type="checkbox"][name="chkMainAlbum"]').prop('checked', false);
            $('#listMainAlbum tr').removeClass('selectedRow');
        },
        delRow: function () {

            this.albumHessedList.forEach((album, index) => {
                if ($('#listSubAlbum tr.selectedRow').index() == index) {
                    $('input[type="checkbox"][name="chkSubAlbum"]:checked').closest('tr').remove();
                    this.albumHessedList.splice(index);
                }
            });
        },
        addDunamisRow: function () {

            this.albumHessedList.filter((album, index) => $('#listSubAlbum tr.selectedRow').index() == index).forEach((album) => {

                let innerHTML = "";

                innerHTML += '<tr>';
                innerHTML +=    '<td><input type = "checkbox" name="chkDunamisAlbum"></td>';
                innerHTML +=    '<td>' + album.title + '</td>';
                innerHTML +=    '<td>' + album.singer + '</td>';
                innerHTML += '</tr>';

                $('#listDunamisAlbum').append(innerHTML);

                this.albumDunamisList = album;
            });

            $('input[type="checkbox"][name="chkSubAlbum"]').prop('checked', false);
            $('#listSubAlbum tr').removeClass('selectedRow');
        },
        downloadAlbumList: function () {

            const data = {
                hessed: this.albumHessedList,
                dunamis: this.albumDunamisList
            };

            $.ajax({
                data: JSON.stringify(data),
                contentType: 'application/json',
                url: '/download',
                type: 'POST',
                success: (data) => {
                    alert("다운로드 되었습니다.");
                },
                error: (error) => {
                    alert("오류가 발생하였습니다.");
                }
            });
        },
    };

    $(function () {
        media.init();
    });
</script>
